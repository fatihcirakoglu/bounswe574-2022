{% load static %}
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@300&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'annotator.min.css' %}" />
    <link rel="stylesheet" href="{% static 'annotator.touch.css' %}" />

    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.1/css/all.min.css"
      integrity="sha512-+4zCK9k+qNFUR5X+cKL9EIR+ZOhtIloNl9GIKS57V1MyNsYpYcUrUeQc9vNfzsWfV28IaLL3i96P9sdNyeRssA=="
      crossorigin="anonymous"
    />
    <title>{% block title %} {% endblock title %}</title>
    <link rel="stylesheet" href="{% static 'styles.css' %}">
    <link rel="stylesheet" href="{% static 'font-awesome.css' %}" />
  </head>
  <body id="content">
    {% block content %} {% endblock content %}
    <div>
      {% for message in messages %}
      <p class="{{message.tags}}">{{message}}</p>
      {% endfor %}
    </div>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script>
      const inputs = document.querySelectorAll("div.input input");
      inputs.forEach((input) => {
        input.addEventListener("focus", () =>
          input.parentElement.classList.add("focusing")
        );
        input.addEventListener("blur", () =>
          input.parentElement.classList.remove("focusing")
        );
      });
      function updateText(btn, newCount, verb) {
        $("#pTest").text(newCount);
      }
      $(".like-btn").click(function (e) {
        e.preventDefault();
        var this_ = $(this);
        var likeUrl = this_.attr("data-href");
        if (likeUrl) {
          $.ajax({
            url: likeUrl,
            method: "GET",
            data: {},
            success: function (data) {
              var newLikes;
              if (data.liked) {
                //add one like
                updateText(this_, data.count, data.verb);
                $("#hid").removeClass("fa-heart-o").addClass("fa-heart");
              } else {
                //remove one like
                $("#hid").removeClass("fa-heart").addClass("fa-heart-o");
                updateText(this_, data.count, data.verb);
              }
            },
            error: function (error) {
              alert("Oops! Error Occurred");
            },
          });
        }
      });
    </script>
    <script src="{% static 'jquery.js' %}"></script>
    <script src="{% static 'highlighter.js' %}"></script>
    <script src="{% static 'annotator-full.min.js' %}"></script>
    <script src="{% static 'annotator.touch.min.js' %}"></script>
    <script src="{% static 'annotator.offline.min.js' %}"></script>
    <script>
      jQuery("#content").annotator().annotator('addPlugin', 'Touch', {
        force: location.search.indexOf('force') > -1,
        useHighlighter: location.search.indexOf('highlighter') > -1
      });

      jQuery("#content").annotator().annotator('addPlugin', 'Offline', {
        online:  function () {
          jQuery("#status").text("Online");
        },
        offline: function () {
          jQuery("#status").text("Offline");
        }    });

      jQuery("#clear-storage").click(function () {
        if (annotator) {
          annotator.plugins.Offline.store.clear()
        }
      });

      if (!Annotator.Plugin.Touch.isTouchDevice()) {
        if (location.search.indexOf('force') > -1) {
          jQuery("body").prepend('<p><a href="./index.html">Disable Plugin in Desktop Browser</a></p>');
        } else {
          jQuery("body").prepend('<p><a href="./index.html?force">Enable Plugin in Desktop Browser</a></p>');
        }
      }

      var annotator = jQuery("#content").data('annotator');
    </script>
  </body>
</html>
